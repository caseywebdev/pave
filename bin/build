#!/bin/sh -e

node_modules/.bin/kiss-test 'src/**/*.test.js'

node_modules/.bin/eslint --fix

node_modules/.bin/tsc \
  --allowJs \
  --declaration \
  --emitDeclarationOnly \
  --module NodeNext \
  --moduleResolution NodeNext \
  --outDir types \
  --rootDir src \
  --strict \
  --target ESNext \
  src/index.js

# Fix the generated types
sed -i '' 's/#src\(.*\).js/#types\1.d.ts/' types/*.d.ts
sed -i '' 's/^export {/export type {/' types/*.d.ts

node_modules/.bin/tsc || true
